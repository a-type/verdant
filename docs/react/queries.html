<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-react/queries">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Query hooks | Verdant</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:url" content="https://verdant.dev/docs/react/queries"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" name="twitter:title" content="verdant"><meta data-rh="true" name="twitter:description" content="a framework for small, sustainable, human apps"><meta data-rh="true" name="twitter:image" content="https://verdant.dev/opengraph.png"><meta data-rh="true" name="og:image" content="https://verdant.dev/opengraph.png"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Query hooks | Verdant"><meta data-rh="true" name="description" content="Query hooks for each collection in your schema are generated by the CLI with specific names. See sections below for a more detailed API."><meta data-rh="true" property="og:description" content="Query hooks for each collection in your schema are generated by the CLI with specific names. See sections below for a more detailed API."><link data-rh="true" rel="icon" href="/favicon.ico"><link data-rh="true" rel="canonical" href="https://verdant.dev/docs/react/queries"><link data-rh="true" rel="alternate" href="https://verdant.dev/docs/react/queries" hreflang="en"><link data-rh="true" rel="alternate" href="https://verdant.dev/docs/react/queries" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Verdant RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Verdant Atom Feed"><link rel="stylesheet" href="/assets/css/styles.be541540.css">
<link rel="preload" href="/assets/js/runtime~main.4c597920.js" as="script">
<link rel="preload" href="/assets/js/main.14e71cf5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_eIEi">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/favicon-32x32.png" alt="Verdant logo" class="themedImage_beWv themedImage--light_exrc"><img src="/favicon-32x32.png" alt="Verdant logo" class="themedImage_beWv themedImage--dark_pILn"></div><b class="navbar__title text--truncate">Verdant</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/a-type/verdant" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xFd0"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_HUOJ colorModeToggle_o5Lg"><button class="clean-btn toggleButton_gW0E toggleButtonDisabled_I930" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_yIZj"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon__Orw"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_VRWN"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_VBNG docsWrapper_LBdX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_UAI6" type="button"></button><div class="docPage_KkIF"><aside class="theme-doc-sidebar-container docSidebarContainer_F0G2"><div class="sidebar_vI3c"><nav class="menu thin-scrollbar menu_FXTG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Intro to Verdant</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/manifesto">The Verdant manifesto on sustainable software</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/storing--querying">Storing &amp; Querying</a><button aria-label="Toggle the collapsible sidebar category &#x27;Storing &amp; Querying&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/sync">Sync</a><button aria-label="Toggle the collapsible sidebar category &#x27;Sync&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cli">CLI</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/react-bindings">React Bindings</a><button aria-label="Toggle the collapsible sidebar category &#x27;React Bindings&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/react/generation">Getting started with React</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/react/queries">Query hooks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/react/reactivity">Reactivity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/react/field">&#x27;Field&#x27; ergonomics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/react/examples">Usage examples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/react/router">React Router</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/how-it-works">How it works</a><button aria-label="Toggle the collapsible sidebar category &#x27;How it works&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/comparisons">Comparisons to other local-first tools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/efficiency">Efficiency &amp; Performance</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/tutorials">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_QByR"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_ZJLC"><div class="docItemContainer_zSnL"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_KjbN" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_TXuR"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/react-bindings"><span itemprop="name">React Bindings</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Query hooks</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_mgR6 theme-doc-toc-mobile tocMobile_HGI4"><button type="button" class="clean-btn tocCollapsibleButton_cxuZ">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Query hooks</h1><p>Query hooks for each collection in your schema are generated by the CLI with specific names. See sections below for a more detailed API.</p><p>For example, if you have a collection named <code>todoItems</code>, you will get these query hooks:</p><ul><li><code>useTodoItem</code>: Retrieves one document. You pass in an id.</li><li><code>useOneTodoItem</code>: pass an index query to filter the list of returned items, and only take the first match.</li><li><code>useAllTodoItems</code>: pass an index query to filter the list of returned items.</li><li><code>useAllTodoItemsPaginated</code>: pass an index query to filter the list of returned items. Paginates data according to the <code>pageSize</code> parameter. When the next page is fetched, the prior page is discarded. Good for paginated interfaces. Returns a tuple: <code>[page, tools]</code>.</li><li><code>useAllTodoItemsInfinite</code>: pass an index query to filter the list of returned items. Paginates data according to the <code>pageSize</code> parameter, but appends newly fetched pages to the end of the list instead of replacing the returned set. Good for infinite scrolling lists. Returns a tuple: <code>[itemsSoFar, tools]</code>.</li></ul><h2 class="anchor anchorWithStickyNavbar_xOZl" id="suspense">Suspense<a class="hash-link" href="#suspense" title="Direct link to heading">​</a></h2><p>The hooks use Suspense so that you don&#x27;t have to write loading state conditional code in your components. All hooks return data directly. If the data is not ready, they suspend.</p><p>Wrap your app in a <code>&lt;Suspense&gt;</code> to handle this. You can create multiple layers of Suspense to handle loading more granularly.</p><h3 class="anchor anchorWithStickyNavbar_xOZl" id="opting-out-of-suspense">Opting out of Suspense<a class="hash-link" href="#opting-out-of-suspense" title="Direct link to heading">​</a></h3><p>In addition to just not liking Suspense, there are various reasons you may want to opt out for specific queries. Each query hook has an equivalent hook with the word <code>Unsuspended</code> appended to the name. These hooks will return <code>{ data, status }</code> instead of the dataset directly. <code>data</code> will be <code>null</code> for single-item queries and <code>[]</code> for list queries, until <code>status</code> is <code>&quot;ready&quot;</code>. Possible <code>status</code> values are: <code>&quot;initial&quot;, &quot;initializing&quot;, &quot;revalidating&quot;, and &quot;ready&quot;</code>.</p><blockquote><p><strong>NOTE:</strong> presently, there are no Unsuspended versions of paginated queries. Let me know if you really need those in a Github issue.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_xOZl" id="query-hook-types-in-depth">Query hook types in-depth<a class="hash-link" href="#query-hook-types-in-depth" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_xOZl" id="use___"><code>use___</code><a class="hash-link" href="#use___" title="Direct link to heading">​</a></h3><p>Pass a document&#x27;s primary key to load it. If the document does not exist, returns <code>null</code>. Keep in mind that if you know the primary key ahead of time, a document may not be available until it is synced from a peer. You should always handle the <code>null</code> case.</p><h3 class="anchor anchorWithStickyNavbar_xOZl" id="useone___"><code>useOne___</code><a class="hash-link" href="#useone___" title="Direct link to heading">​</a></h3><p>Use an index filter to select the first matching document. If no filter is passed, an arbitrary document is returned. Returns <code>null</code> if no matching document exists.</p><h3 class="anchor anchorWithStickyNavbar_xOZl" id="useall___"><code>useAll___</code><a class="hash-link" href="#useall___" title="Direct link to heading">​</a></h3><p>Load all documents, or use an index filter to load a subset. Returns all matched documents as an array.</p><h3 class="anchor anchorWithStickyNavbar_xOZl" id="useall___paginated"><code>useAll___Paginated</code><a class="hash-link" href="#useall___paginated" title="Direct link to heading">​</a></h3><p>Load a page of documents, with or without an index filter. Returns a tuple. The first tuple value is an array of documents representing the current page. The second value is an object of &quot;tools&quot; for manipulating pagination:</p><div class="codeBlockContainer_O3ds theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Nb2v"><pre tabindex="0" class="prism-code language-text codeBlock_OTj6 thin-scrollbar"><code class="codeBlockLines_RheW"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status,      // the query status (initial, initializing, ready, revalidating)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 // this will be &quot;revalidating&quot; while a new page is being fetched</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hasNext,     // a boolean indicating if a next page is available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hasPrevious, // a boolean indicating if a previous page is available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    next,        // call this function to advance to the next page (no-op if none exists)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    previous,    // call this function to go back to the previous page (no-op if none exists)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    setPage,     // call this with a page index to jump to a page</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_euy6"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nqra" aria-hidden="true"><svg class="copyButtonIcon_TBKK" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_igq5" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_xOZl" id="useall___infinite"><code>useAll___Infinite</code><a class="hash-link" href="#useall___infinite" title="Direct link to heading">​</a></h3><p>Loads a page of documents, with or without an index filter. When additional pages are loaded, they are appended to the result set, rather than replacing it. Returns a tuple. The first tuple value is an array of documents representing the current page. The second value is an object of &quot;tools&quot; for manipulating pagination:</p><div class="codeBlockContainer_O3ds theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Nb2v"><pre tabindex="0" class="prism-code language-text codeBlock_OTj6 thin-scrollbar"><code class="codeBlockLines_RheW"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status,      // the query status (initial, initializing, ready, revalidating)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 // this will be &quot;revalidating&quot; while a new page is being fetched</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hasMore,     // a boolean indicating if more data is available to load</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loadMore,    // call this function to load the next page of data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_euy6"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nqra" aria-hidden="true"><svg class="copyButtonIcon_TBKK" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_igq5" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_xOZl" id="query-reactivity">Query reactivity<a class="hash-link" href="#query-reactivity" title="Direct link to heading">​</a></h2><p>When using hooks to run queries in React, the hook will only re-render your React component when the <em>set of documents returned by the query</em> changes. It will not re-render your component if the contents of those documents change; to monitor document data, you should pass a document to <code>useWatch</code>.</p><h2 class="anchor anchorWithStickyNavbar_xOZl" id="query-keys-and-identity">Query keys and identity<a class="hash-link" href="#query-keys-and-identity" title="Direct link to heading">​</a></h2><blockquote><p><em>TL;DR</em>: When query index filters are dynamic, pass <code>key</code> to the hook to prevent memory and CPU waste or unexpected React suspense triggering.</p></blockquote><p>React bindings for Verdant queries provide a high level of convenience for altering query index filters on the fly, but there are caveats.</p><p>Consider the following example:</p><div class="language-tsx codeBlockContainer_O3ds theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Nb2v"><pre tabindex="0" class="prism-code language-tsx codeBlock_OTj6 thin-scrollbar"><code class="codeBlockLines_RheW"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">inputValue</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setInputValue</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> posts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hooks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">useAllPosts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    index</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        where</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;titleMatch&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        eq</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> inputValue</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_euy6"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nqra" aria-hidden="true"><svg class="copyButtonIcon_TBKK" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_igq5" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If <code>inputValue</code> is connected to a user-facing input, as the user types, this value will change rapidly. Because the filter of the query changes, its automatically computed cache key will also change, so the prior query will actually be discarded with each keystroke. This is wasteful!</p><p>To prevent this, you should pass a <code>key</code> value to the hook. When a <code>key</code> is specified, the query is retained and its filter is updated, instead of launching a new query. Your <code>key</code> should be unique to the component / usage context of this particular query. For example, <code>&quot;postsFilteredByInput&quot;</code> might be a good key for the example above.</p><p>In the future, default key value behavior and/or the optionality of <code>key</code> in these hooks may change. I&#x27;m still working on the ergonomics.</p><h3 class="anchor anchorWithStickyNavbar_xOZl" id="sharing-keys-to-reference-the-same-query-in-different-places">Sharing keys to reference the same query in different places<a class="hash-link" href="#sharing-keys-to-reference-the-same-query-in-different-places" title="Direct link to heading">​</a></h3><p>Since queries are cached by key, once you&#x27;ve specified a <code>key</code> value for a query hook somewhere, using the same key elsewhere will immediately load the in-memory cached query. You can exploit this to move queries downward in your React tree without performance loss: rather than have one query at the top of the app for commonly used data and passing that down, you can encapsulate this query in a reusable hook with a hardcoded key and call it freely from any component in your app.</p><div class="language-ts codeBlockContainer_O3ds theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Nb2v"><pre tabindex="0" class="prism-code language-ts codeBlock_OTj6 thin-scrollbar"><code class="codeBlockLines_RheW"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useFilteredPosts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// this is just for example&#x27;s sake, suppose we have a search string provided</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// by some app context state to use.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> filterValue </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useFilterContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> hooks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">useAllPosts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        index</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            where</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;titleMatch&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            eq</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> filterValue</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;filteredPosts&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_euy6"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nqra" aria-hidden="true"><svg class="copyButtonIcon_TBKK" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_igq5" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Don&#x27;t overdo it</strong> -- be careful not to reuse the same key if different subscribers to this query may expect different data, for example if a different filter value is supplied in different parts of the app. Once a key is applied, all usages of query hooks using that key will receive the exact same data.</p><h2 class="anchor anchorWithStickyNavbar_xOZl" id="query-disposal-and-keep-alive">Query disposal and keep-alive<a class="hash-link" href="#query-disposal-and-keep-alive" title="Direct link to heading">​</a></h2><p>Utilizing <code>client.queries.keepAlive</code> can help manage query disposal behavior. Normally, once a React component which used a query is unmounted, if no other subscribing components exist, the query will be disposed after 5 seconds. Remounting that component later will require reloading the entire query from disk.</p><p>To prevent this disposal, you can use <code>client.queries.keepAlive</code>, passing in the query&#x27;s <code>key</code>. This is best done with custom keys.</p><p>A good place to put <code>keepAlive</code> might be in a top-level route component in a nested route structure. For example, suppose you have a route structure of <code>/posts/:postId</code>. In your <code>/posts</code> page, you query all posts with a filter, but on the <code>/posts/:postId</code> page, the component which performed that query is unmounted to show the individual post. In this case, when users view a specific post for more than 5 seconds, the filtered post query is unloaded. When they navigate back to <code>/posts</code>, the app has to re-fetch the posts list.</p><p>You can optimize this by keeping the posts list query in memory with a keep-alive. Find a common ancestor React component which remains mounted on both the <code>/posts</code> and <code>/posts/:postId</code> pages, and include something like this:</p><div class="language-ts codeBlockContainer_O3ds theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Nb2v"><pre tabindex="0" class="prism-code language-ts codeBlock_OTj6 thin-scrollbar"><code class="codeBlockLines_RheW"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hooks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">useClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">queries</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">keepAlive</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;postsList&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">queries</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">dropKeepAlive</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;postsList&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_euy6"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nqra" aria-hidden="true"><svg class="copyButtonIcon_TBKK" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_igq5" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This <code>useEffect</code> will mark a keep-alive hold on the query with the key <code>postsList</code> while the component is mounted, then remove the hold after it unmounts. As long as this hook is run in a component which stays mounted on both route paths, users can remain on the post page as long as they want and the post list query will remain fresh.</p><p>Keep in mind that you shouldn&#x27;t just put this at the global app level, unless you&#x27;re ok with the post list query remaining in-memory indefinitely. Where you place this hook makes all the difference.</p><p>You could also place this hook within the post page component! As long as there is less than 5 seconds between the posts list unmounting and the post page mounting, the keep alive should come into effect before the list query is disposed.</p><h3 class="anchor anchorWithStickyNavbar_xOZl" id="keep-alive-outside-react-hooks">Keep-alive outside React hooks<a class="hash-link" href="#keep-alive-outside-react-hooks" title="Direct link to heading">​</a></h3><p>The example above uses React hooks to place and remove keep-alive holds. You can also reference the client directly with a query key to do this. Keep in mind you need a reference to the resolved, initialized Client, not the ClientDescriptor. React normally uses Suspense to avoid thinking about that, but if you need the Client outside React, you&#x27;ll need something like:</p><div class="language-ts codeBlockContainer_O3ds theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Nb2v"><pre tabindex="0" class="prism-code language-ts codeBlock_OTj6 thin-scrollbar"><code class="codeBlockLines_RheW"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> clientDesc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">queries</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">keepAlive</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;some-key&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_euy6"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nqra" aria-hidden="true"><svg class="copyButtonIcon_TBKK" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_igq5" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is true of Verdant vanilla JS usage generally, but since you&#x27;re in the React docs you may not be aware of that.</p><p>I&#x27;m looking into ways of removing this extra <code>await</code> step since it&#x27;s very inconvenient.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/react/generation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Getting started with React</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/react/reactivity"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Reactivity</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_Vsyg thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#suspense" class="table-of-contents__link toc-highlight">Suspense</a><ul><li><a href="#opting-out-of-suspense" class="table-of-contents__link toc-highlight">Opting out of Suspense</a></li></ul></li><li><a href="#query-hook-types-in-depth" class="table-of-contents__link toc-highlight">Query hook types in-depth</a><ul><li><a href="#use___" class="table-of-contents__link toc-highlight"><code>use___</code></a></li><li><a href="#useone___" class="table-of-contents__link toc-highlight"><code>useOne___</code></a></li><li><a href="#useall___" class="table-of-contents__link toc-highlight"><code>useAll___</code></a></li><li><a href="#useall___paginated" class="table-of-contents__link toc-highlight"><code>useAll___Paginated</code></a></li><li><a href="#useall___infinite" class="table-of-contents__link toc-highlight"><code>useAll___Infinite</code></a></li></ul></li><li><a href="#query-reactivity" class="table-of-contents__link toc-highlight">Query reactivity</a></li><li><a href="#query-keys-and-identity" class="table-of-contents__link toc-highlight">Query keys and identity</a><ul><li><a href="#sharing-keys-to-reference-the-same-query-in-different-places" class="table-of-contents__link toc-highlight">Sharing keys to reference the same query in different places</a></li></ul></li><li><a href="#query-disposal-and-keep-alive" class="table-of-contents__link toc-highlight">Query disposal and keep-alive</a><ul><li><a href="#keep-alive-outside-react-hooks" class="table-of-contents__link toc-highlight">Keep-alive outside React hooks</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/a-type/verdant" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xFd0"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gfor.rest" target="_blank" rel="noopener noreferrer" class="footer__link-item">Who made this?</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Grant Forrest. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.4c597920.js"></script>
<script src="/assets/js/main.14e71cf5.js"></script>
</body>
</html>