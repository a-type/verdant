<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-internals/diffing" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Auto-diffing | Verdant</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:url" content="https://verdant.dev/docs/internals/diffing"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" name="twitter:title" content="verdant"><meta data-rh="true" name="twitter:description" content="a framework for small, sustainable, human apps"><meta data-rh="true" name="twitter:image" content="https://verdant.dev/opengraph.png"><meta data-rh="true" name="og:image" content="https://verdant.dev/opengraph.png"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Auto-diffing | Verdant"><meta data-rh="true" name="description" content="Verdant comes with some moderately sophisticated auto-diffing of nested JSON content. While most of the time you should make specific and intentional changes to data using entity methods like .set, .push, etc, diffing comes into play in two scenarios:"><meta data-rh="true" property="og:description" content="Verdant comes with some moderately sophisticated auto-diffing of nested JSON content. While most of the time you should make specific and intentional changes to data using entity methods like .set, .push, etc, diffing comes into play in two scenarios:"><link data-rh="true" rel="icon" href="/favicon.ico"><link data-rh="true" rel="canonical" href="https://verdant.dev/docs/internals/diffing"><link data-rh="true" rel="alternate" href="https://verdant.dev/docs/internals/diffing" hreflang="en"><link data-rh="true" rel="alternate" href="https://verdant.dev/docs/internals/diffing" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.848d850d.css">
<script src="/assets/js/runtime~main.a6db9cdd.js" defer="defer"></script>
<script src="/assets/js/main.d5eb756f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/favicon-32x32.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_grwm" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/favicon-32x32.png" alt="Verdant logo" class="themedComponent_Mp3Q themedComponent--light_arQ9"><img src="/favicon-32x32.png" alt="Verdant logo" class="themedComponent_Mp3Q themedComponent--dark_edNh"></div><b class="navbar__title text--truncate">Verdant</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/a-type/verdant" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_TkHd"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_HTtc colorModeToggle_Zc6n"><button class="clean-btn toggleButton_dCld toggleButtonDisabled_khVH" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_SvTK"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_rGd6"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_DQnC"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_R_Gv"><div class="docsWrapper_KMAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_N8Xm" type="button"></button><div class="docRoot_BQ69"><aside class="theme-doc-sidebar-container docSidebarContainer_eA7o"><div class="sidebarViewport_Ubog"><div class="sidebar_pztp"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_I60q"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Intro to Verdant</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/manifesto">The Verdant manifesto on sustainable software</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/storing--querying">Storing &amp; Querying</a><button aria-label="Expand sidebar category &#x27;Storing &amp; Querying&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/sync">Sync</a><button aria-label="Expand sidebar category &#x27;Sync&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cli">CLI</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/react-bindings">React Bindings</a><button aria-label="Expand sidebar category &#x27;React Bindings&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/integrations">Integrations</a><button aria-label="Expand sidebar category &#x27;Integrations&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/how-it-works">How it works</a><button aria-label="Collapse sidebar category &#x27;How it works&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/internals/initial-sync">Initial sync</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/internals/assumptions">Protocol assumptions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/internals/entity-ids">Entity IDs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/internals/diffing">Auto-diffing</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/comparisons">Comparisons to other local-first tools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/efficiency">Efficiency &amp; Performance</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/tutorials">Tutorials</a><button aria-label="Expand sidebar category &#x27;Tutorials&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_WevJ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Q61k"><div class="docItemContainer_j_9H"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Om02" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_nKsh"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/how-it-works"><span itemprop="name">How it works</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Auto-diffing</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_e9xA theme-doc-toc-mobile tocMobile_soHF"><button type="button" class="clean-btn tocCollapsibleButton_rkxb">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Auto-diffing</h1></header>
<p>Verdant comes with some moderately sophisticated auto-diffing of nested JSON content. While most of the time you should make specific and intentional changes to data using entity methods like <code>.set</code>, <code>.push</code>, etc, diffing comes into play in two scenarios:</p>
<ul>
<li>Migrations: when using the <code>migrate(&#x27;collection&#x27;, ...)</code> tool, the migration function receives a snapshot of the document and returns a migrated plain object. The migration engine then uses Verdant&#x27;s diffing algorithm to determine what changes to apply for the migration.</li>
<li><code>.update</code>: Object entities have a <code>.update</code> field which accepts a deep object representation to apply to the entire entity. <code>.update</code> allows full replacement of the object, or a deep merge where new fields overwrite old ones but any untouched fields are retained. Both versions use Verdant&#x27;s diffing algorithm.</li>
</ul>
<blockquote>
<p>Note: for the migrations use case, I&#x27;m considering a future update which deprecates diff-based migrations and exposes the same entity tools as the runtime code to enable more intentional migration changes.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_AMdt" id="how-diffing-works">How diffing works<a href="#how-diffing-works" class="hash-link" aria-label="Direct link to How diffing works" title="Direct link to How diffing works">​</a></h2>
<p>The diffing algorithm is fairly complex and tries to produce a minimal changeset, within reason. This means it may make some assumptions which don&#x27;t match user intention. So, I thought I&#x27;d clarify what happens here. All of this behavior is covered in unit tests, too.</p>
<h3 class="anchor anchorWithStickyNavbar_AMdt" id="object-identity-preservation">Object identity preservation<a href="#object-identity-preservation" class="hash-link" aria-label="Direct link to Object identity preservation" title="Direct link to Object identity preservation">​</a></h3>
<p>Diffing will always make an effort to preserve the identities of sub-objects. Verdant assigns unique identifiers to all sub-objects, so if these identifiers are available for incoming data, it will match up identities and only apply internal changes to these objects instead of replacing them. For example, if you started from <code>{ foo: { bar: 1 } }</code> and ended with <code>{ foo: { bar: 2 } }</code>:</p>
<ul>
<li>If the sub-object has retained its Verdant identifier reference, the produced diff will only apply the <code>bar: 1 -&gt; 2</code> change.</li>
<li>If the sub-object has not retained its Verdant identifier, the produced change will assign the root <code>foo</code> key to a brand new object, <code>{ bar: 2 }</code>.</li>
</ul>
<p>Obviously the second case is not very efficient, especially if you have large and deeply nested structures. So in addition to attempting to preserve object identity references (which is often brittle and cannot be maintained with user-supplied objects), Verdant also exposes an option to <code>.update</code> called <code>replaceSubObjects</code>. When this is off (default), Verdant will assume any incoming object which has no assigned identity is the same as whatever was already there. By turning this option off, you can instead intentionally produce the second outcome above.</p>
<h3 class="anchor anchorWithStickyNavbar_AMdt" id="prevention-of-moving-objects-or-multiple-references-to-the-same-object">Prevention of moving objects or multiple references to the same object<a href="#prevention-of-moving-objects-or-multiple-references-to-the-same-object" class="hash-link" aria-label="Direct link to Prevention of moving objects or multiple references to the same object" title="Direct link to Prevention of moving objects or multiple references to the same object">​</a></h3>
<p>Suppose you did something like this,</p>
<div class="language-ts codeBlockContainer_plQo theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Dd25"><pre tabindex="0" class="prism-code language-ts codeBlock_xRQy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMg_"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> foo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> doc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;foo&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">doc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	bar</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> foo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getSnapshot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_VNA8"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_HEVz" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_O4HX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_nU10"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Naively, this appears to take the <code>foo</code> field and assign it to the <code>bar</code> key. Since merge is on by default, this would mean this same object is assigned to two keys in <code>doc</code>.</p>
<p>Verdant&#x27;s diffing algorithm does not allow this. Mainly because it would be a footgun in most cases, producing documents with fields that unexpectedly update when &#x27;other&#x27; fields change. Verdant assumes that even if you do something like the above, your intention is to create a copy of the same data in the other field. So, it creates the clone for you automatically, initializing it and assigning it a new identity.</p>
<p>Right now there is no way to alter that behavior. So, this prevents not only multiple assignments, but also the movement of a sub-object from one key to another while preserving its identity (note: this is possible with list entities, though, using special methods like <code>.move</code>).</p>
<p>If there&#x27;s a use case for moving objects with preserved identities within objects or maps, let me know with an issue, I can probably make this work.</p>
<h3 class="anchor anchorWithStickyNavbar_AMdt" id="list-heuristics">List heuristics<a href="#list-heuristics" class="hash-link" aria-label="Direct link to List heuristics" title="Direct link to List heuristics">​</a></h3>
<p>Lists are pretty complicated to diff well, and on top of that, the result of a bad diff can be particularly gross. For example, if you had a list diff like</p>
<div class="codeBlockContainer_plQo theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Dd25"><pre tabindex="0" class="prism-code language-text codeBlock_xRQy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMg_"><span class="token-line" style="color:#393A34"><span class="token plain">[0, 1, 3, 4, 5, 6, 7] -&gt; [0, 1, 2, 3, 4, 5, 6, 7]</span><br></span></code></pre><div class="buttonGroup_VNA8"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_HEVz" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_O4HX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_nU10"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>A human can easily grasp that the intention was to just insert <code>2</code>. But a naive list diff will instead <em>set</em> 2 to the third position, then proceed to erase and overwrite every subsequent value, losing all identities in the process.</p>
<p>The irony here is, diffing is most useful for quick integration with complex document objects like rich text schemas, in which this kind of insertion (say, inserting a paragraph in the middle of a large document) is incredibly common, and where the preservation of item identities is crucial to sane collaboration!</p>
<p>So the diffing algorithm must be a little more smart than that.</p>
<p>As of writing this, though, it&#x27;s still a work in progress. Here are some supported behaviors:</p>
<ol>
<li>Diffs can detect a single insertion of an item, as long as the items on either side retain their identities. It cannot (yet) detect insertions of ranges of items.</li>
<li>Diffs will encode items added past the end of the original list as pushes, not sets.</li>
</ol>
<p>These conventions at least allow you to use diffing to insert one new item in the middle of a list, as long as Verdant object identities are preserved. However, this relies on identity preservation, which is a challenge. Verdant&#x27;s <a href="/docs/integrations/tiptap">TipTap</a> integration, for example, writes object identifiers to the attributes of all document nodes under the hood, just so it can read them again when changed data is delivered from the editor and reconstruct the identity tree of the document before diffing. But even this is tenuous, and will probably be replaced with non-diff-based change tracking as that integration matures.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/internals/entity-ids"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Entity IDs</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/comparisons"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Comparisons to other local-first tools</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_GnxE thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-diffing-works" class="table-of-contents__link toc-highlight">How diffing works</a><ul><li><a href="#object-identity-preservation" class="table-of-contents__link toc-highlight">Object identity preservation</a></li><li><a href="#prevention-of-moving-objects-or-multiple-references-to-the-same-object" class="table-of-contents__link toc-highlight">Prevention of moving objects or multiple references to the same object</a></li><li><a href="#list-heuristics" class="table-of-contents__link toc-highlight">List heuristics</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/a-type/verdant" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_TkHd"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gfor.rest" target="_blank" rel="noopener noreferrer" class="footer__link-item">Who made this?</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Grant Forrest. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>