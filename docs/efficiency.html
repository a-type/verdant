<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-efficiency" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Efficiency &amp; Performance | Verdant</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:url" content="https://verdant.dev/docs/efficiency"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" name="twitter:title" content="verdant"><meta data-rh="true" name="twitter:description" content="a framework for small, sustainable, human apps"><meta data-rh="true" name="twitter:image" content="https://verdant.dev/opengraph.png"><meta data-rh="true" name="og:image" content="https://verdant.dev/opengraph.png"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Efficiency &amp; Performance | Verdant"><meta data-rh="true" name="description" content="Since local-first naturally overlaps with the realtime-collaboration space, you&#x27;ll probably see a lot of talk about performance in this space. Many tool builders are very proud of their 60+fps realtime performance (and they should be, it&#x27;s impressive)!"><meta data-rh="true" property="og:description" content="Since local-first naturally overlaps with the realtime-collaboration space, you&#x27;ll probably see a lot of talk about performance in this space. Many tool builders are very proud of their 60+fps realtime performance (and they should be, it&#x27;s impressive)!"><link data-rh="true" rel="icon" href="/favicon.ico"><link data-rh="true" rel="canonical" href="https://verdant.dev/docs/efficiency"><link data-rh="true" rel="alternate" href="https://verdant.dev/docs/efficiency" hreflang="en"><link data-rh="true" rel="alternate" href="https://verdant.dev/docs/efficiency" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.848d850d.css">
<script src="/assets/js/runtime~main.a6db9cdd.js" defer="defer"></script>
<script src="/assets/js/main.d5eb756f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/favicon-32x32.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_grwm" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/favicon-32x32.png" alt="Verdant logo" class="themedComponent_Mp3Q themedComponent--light_arQ9"><img src="/favicon-32x32.png" alt="Verdant logo" class="themedComponent_Mp3Q themedComponent--dark_edNh"></div><b class="navbar__title text--truncate">Verdant</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/a-type/verdant" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_TkHd"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_HTtc colorModeToggle_Zc6n"><button class="clean-btn toggleButton_dCld toggleButtonDisabled_khVH" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_SvTK"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_rGd6"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_DQnC"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_R_Gv"><div class="docsWrapper_KMAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_N8Xm" type="button"></button><div class="docRoot_BQ69"><aside class="theme-doc-sidebar-container docSidebarContainer_eA7o"><div class="sidebarViewport_Ubog"><div class="sidebar_pztp"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_I60q"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Intro to Verdant</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/manifesto">The Verdant manifesto on sustainable software</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/storing--querying">Storing &amp; Querying</a><button aria-label="Expand sidebar category &#x27;Storing &amp; Querying&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/sync">Sync</a><button aria-label="Expand sidebar category &#x27;Sync&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cli">CLI</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/react-bindings">React Bindings</a><button aria-label="Expand sidebar category &#x27;React Bindings&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/integrations">Integrations</a><button aria-label="Expand sidebar category &#x27;Integrations&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/how-it-works">How it works</a><button aria-label="Expand sidebar category &#x27;How it works&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/comparisons">Comparisons to other local-first tools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/efficiency">Efficiency &amp; Performance</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/tutorials">Tutorials</a><button aria-label="Expand sidebar category &#x27;Tutorials&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_WevJ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Q61k"><div class="docItemContainer_j_9H"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Om02" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_nKsh"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Efficiency &amp; Performance</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_e9xA theme-doc-toc-mobile tocMobile_soHF"><button type="button" class="clean-btn tocCollapsibleButton_rkxb">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Efficiency &amp; Performance</h1></header>
<p>Since local-first naturally overlaps with the realtime-collaboration space, you&#x27;ll probably see a lot of talk about performance in this space. Many tool builders are very proud of their 60+fps realtime performance (and they should be, it&#x27;s impressive)!</p>
<p>I&#x27;m afraid I can&#x27;t reliably boast that with Verdant, which you should know if low-latency realtime collaboration is important to you. But let me explain why...</p>
<h2 class="anchor anchorWithStickyNavbar_AMdt" id="efficiency">Efficiency<a href="#efficiency" class="hash-link" aria-label="Direct link to Efficiency" title="Direct link to Efficiency">​</a></h2>
<p>&quot;Performance&quot; is the word that gets the most visibility, I think, but Verdant often prioritizes efficiency over performance. I&#x27;m not suggesting that these are diametrically opposed, but there <em>are</em> cases where one must be traded off for the other. This might be more clear if I define &quot;efficiency&quot; as I mean it.</p>
<p>&quot;Efficiency&quot; is optimizing for use of available resources across any number of domains. CPU efficiency is often directly correlated to the user&#x27;s experience of &quot;performance,&quot; as in, the app responds faster to input or drops fewer frames. But there are other efficiency targets to worry about: memory is a famously oppositional one to CPU, for example. Often when optimizing for speed, we load more data into memory. Network is another efficiency domain, as is storage.</p>
<p>Verdant is designed to attempt to balance efficiency goals across all of these domains in a way that avoids problematic inefficiencies in any one in particular. For the record, I think it might struggle more on the memory aspect, but I hope this can continue to improve.</p>
<h2 class="anchor anchorWithStickyNavbar_AMdt" id="efficiency-tradeoffs-in-verdant">Efficiency tradeoffs in Verdant<a href="#efficiency-tradeoffs-in-verdant" class="hash-link" aria-label="Direct link to Efficiency tradeoffs in Verdant" title="Direct link to Efficiency tradeoffs in Verdant">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_AMdt" id="storage">Storage<a href="#storage" class="hash-link" aria-label="Direct link to Storage" title="Direct link to Storage">​</a></h3>
<p>To make efficient use of on-device and on-server storage, Verdant uses &quot;rebasing.&quot; An advantage of using server is we can rely on that server as the &#x27;source of truth&#x27; for the state of synced replicas. When Verdant&#x27;s server detects that all active replicas have seen a change, it &#x27;applies&#x27; that change onto a &#x27;baseline,&#x27; flattening the history, and informs all replicas it&#x27;s safe for them to do the same thing. The algorithm for determining &#x27;seen&#x27; is not as straightforward as you might think, since offline replicas can contribute data from the past when they come online. Verdant takes care of this for you automatically, though, and the system is pretty heavily tested.</p>
<p>What this means is something unique in the world of local-first / CRDTs: <em>conflict-free data storage doesn&#x27;t grow monotonically, either on-device or on the server</em>. In fact, if all replicas are frequently coming online to sync changes, the ideal state is that storage size is linear to the size of the actual data represented, basically <code>n + m</code> where <code>m</code> is some amount of light metadata.</p>
<p>But what it means for you, the app developer, <em>is that you can run your app indefinitely without having to monitor and continually expand your server&#x27;s storage volume.</em> It also means you probably don&#x27;t have to worry about partial sync, which is good, because Verdant doesn&#x27;t support it. Whether or not this is a problem for you will depend on whether all of the data a user needs to interact with can fit in the storage allotted to the app by the browser. <a href="https://developer.mozilla.org/en-US/docs/Web/API/Storage_API/Storage_quotas_and_eviction_criteria" target="_blank" rel="noopener noreferrer">For most environments this storage limit is practically limited only by the user&#x27;s hard drive space</a>.</p>
<p>So, Verdant may not seem as future-proof or technically impressive as other systems which support partial sync, but that&#x27;s because it&#x27;s engineered to avoid the problem altogether (which also makes using it simpler).</p>
<p>Oh, and if your client never syncs to a server at all, this rebasing happens automatically on-device, so local-only clients are always maximally storage-efficient.</p>
<h3 class="anchor anchorWithStickyNavbar_AMdt" id="network">Network<a href="#network" class="hash-link" aria-label="Direct link to Network" title="Direct link to Network">​</a></h3>
<p>As previously noted, one thing many other frameworks are able to brag about is latency in realtime scenarios. Changes are broadcast instantly over the network, allowing users to collaborate on whiteboards or documents as if they were on the same computer. It&#x27;s very cool, but Verdant isn&#x27;t quite tuned to do this... at least by default.</p>
<p>Instead, Verdant prioritizes <em>network efficiency</em> by default. Consider what happens if you drag a box on a whiteboard at 60fps in a realtime system. At minimum, to achieve that performance, your replica would be broadcasting 60 changes per second to the network. In many systems, that also means it&#x27;s persisting 60 operations per second to its local database, the server, and peer replicas. And as previously discussed, that often also means those 60 changes per second are retained indefinitely!</p>
<p>Granted, these would be very small changes, akin to <code>{ set: &#x27;x&#x27;, value: 103.5 }</code>. And tools often use techniques for efficient compression and storage of these both on network and disk. I&#x27;m not saying this is bad.</p>
<p>But with Verdant I&#x27;ve opted for something a bit more efficient by default, just in case. Most changes don&#x27;t need to be 60fps. Often only one replica is modifying the system at a time, in which case all that granularity is completely redundant.</p>
<p>What Verdant does under the hood is <em>batch and overlay changes</em>. Any changes you make to an object are synchronously applied in-memory across all references to that object in your app, so you get the immediacy of in-memory plain-JS objects for local use. However, this immediacy gets slowed down before those changes are either persisted to storage or sent to sync. Immediate, synchronous, &quot;60+fps&quot; changes are batched, with a rolling window, before that happens. And before the batch is &#x27;committed,&#x27; it runs an algorithm to &#x27;overlay&#x27; redundant changes, further compressing the total changes applied. To explain what that means, let me use an example...</p>
<p>Suppose you were indeed moving a box across a whiteboard, diagonally. At 60fps (or however often your drag events emit), Verdant is applying changes to your box&#x27;s object:</p>
<div class="codeBlockContainer_plQo theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Dd25"><pre tabindex="0" class="prism-code language-text codeBlock_xRQy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMg_"><span class="token-line" style="color:#393A34"><span class="token plain">-- frame 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{ set: &#x27;x&#x27;, value: 5 }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{ set: &#x27;y&#x27;, value: -30 }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- frame 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{ set: &#x27;x&#x27;, value: 6 }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{ set: &#x27;y&#x27;, value: -29.9 }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- frame 50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{ set: &#x27;x&#x27;, value: 204 }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{ set: &#x27;y&#x27;, value: 165.3 }</span><br></span></code></pre><div class="buttonGroup_VNA8"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_HEVz" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_O4HX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_nU10"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And so on. These changes are applied synchronously in-memory to keep your interaction snappy. However, they&#x27;re also fed into the batching system. The default batching heuristics aren&#x27;t guaranteed (I might tweak them) but let&#x27;s say for this example they&#x27;re something like: 1s or 100 changes, whichever comes first.</p>
<p>In that case, once one of those conditions are met, the batch is &#x27;committed,&#x27; which means it&#x27;s flushed to both local storage and sync (if connected). Before it&#x27;s flushed, the &#x27;overlay&#x27; algorithm runs over the whole batch to drop &#x27;superseded&#x27; changes. In this example, we&#x27;re setting the <code>x</code> and <code>y</code> keys repeatedly. Only the latest of those changes will actually affect the final state of the object; all the rest are superseded. Suppose we hit the 100 change limit for the batch (at 60fps, with 2 changes per frame, that would only take less than a second). After the &#x27;overlay&#x27; algorithm runs during batch commit, the batch shown above would be reduced to just two operations:</p>
<div class="codeBlockContainer_plQo theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Dd25"><pre tabindex="0" class="prism-code language-text codeBlock_xRQy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMg_"><span class="token-line" style="color:#393A34"><span class="token plain">{ set: &#x27;x&#x27;, value: 204 }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{ set: &#x27;y&#x27;, value: 165.3 }</span><br></span></code></pre><div class="buttonGroup_VNA8"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_HEVz" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_O4HX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_nU10"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>These are the only two operations out of the 100 we applied in-memory which will be stored in our database and broadcast to sync.</p>
<p>This is a nice win for storage and network efficiency, but it has clear tradeoffs with realtime latency! Because we batched up to 100 changes, we waited nearly 1 second before sending the next &#x27;frame&#x27; of interaction to peers. Rather than a 16.6ms framerate (60fps), our ping is more like 833.3ms! Plus network latency, that&#x27;s no good for highly interactive scenarios.</p>
<p>Luckily, we can adjust the batching behavior, even for individual parts of the app. This isn&#x27;t very well documented, but it looks like this:</p>
<div class="language-ts codeBlockContainer_plQo theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Dd25"><pre tabindex="0" class="prism-code language-ts codeBlock_xRQy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMg_"><span class="token-line" style="color:#393A34"><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">batch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> batchName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;canvas-changes&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timeout</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	box</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_VNA8"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_HEVz" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_O4HX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_nU10"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Using <code>batchName</code>, we create a persistent, shared batch with particular configuration for limits. We can run all changes to canvas objects inside batches with the <code>&#x27;canvas-changes&#x27;</code> name to forward them all to the same batch with specified timing.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/comparisons"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Comparisons to other local-first tools</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/tutorials"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Tutorials</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_GnxE thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#efficiency" class="table-of-contents__link toc-highlight">Efficiency</a></li><li><a href="#efficiency-tradeoffs-in-verdant" class="table-of-contents__link toc-highlight">Efficiency tradeoffs in Verdant</a><ul><li><a href="#storage" class="table-of-contents__link toc-highlight">Storage</a></li><li><a href="#network" class="table-of-contents__link toc-highlight">Network</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/a-type/verdant" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_TkHd"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gfor.rest" target="_blank" rel="noopener noreferrer" class="footer__link-item">Who made this?</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Grant Forrest. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>