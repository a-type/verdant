"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9114],{2595:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"cli","title":"CLI","description":"Verdant has a CLI which is vital for generating client typings and upgrading your schema over time. You could theoretically do these things by hand, but it would be really complicated and type safety would be basically infeasible.","source":"@site/docs/cli.md","sourceDirName":".","slug":"/cli","permalink":"/docs/cli","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Tips and tricks for working in distributed systems","permalink":"/docs/sync/tips-and-tricks"},"next":{"title":"React Bindings","permalink":"/docs/category/react-bindings"}}');var i=t(7557),a=t(6039);const s={sidebar_position:5},r="CLI",l={},c=[{value:"How to use the CLI",id:"how-to-use-the-cli",level:2},{value:"WIP Schemas",id:"wip-schemas",level:2},{value:"Verifying your schema for deployment",id:"verifying-your-schema-for-deployment",level:3},{value:"Upgrading",id:"upgrading",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"cli",children:"CLI"})}),"\n",(0,i.jsx)(n.p,{children:"Verdant has a CLI which is vital for generating client typings and upgrading your schema over time. You could theoretically do these things by hand, but it would be really complicated and type safety would be basically infeasible."}),"\n",(0,i.jsxs)(n.p,{children:["The CLI generates client code which you ",(0,i.jsx)(n.strong,{children:"should commit to version control."})," This code is vital to your app."]}),"\n",(0,i.jsx)(n.p,{children:"The CLI generates:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A client with your schema pre-loaded"}),"\n",(0,i.jsx)(n.li,{children:"Strong typings for all your documents in your schema, and index filters for queries against those documents."}),"\n",(0,i.jsx)(n.li,{children:"Migrations to go from one schema version to the next."}),"\n",(0,i.jsx)(n.li,{children:"React hooks and associated typings, if you choose."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The generated code also keeps historical versions of every deployed schema. This may seem excessive, but for local-first apps it's actually pretty important and powers migrations."}),"\n",(0,i.jsx)(n.h2,{id:"how-to-use-the-cli",children:"How to use the CLI"}),"\n",(0,i.jsx)(n.p,{children:"First, make some changes to your schema file which reflect changes you want to make to your app. I like to use this part of the process to think through how I want my data to work and plan out the features my changes will enable. Kind of like any other database schema work."}),"\n",(0,i.jsxs)(n.p,{children:["Then, run the CLI with ",(0,i.jsx)(n.code,{children:"npx verdant -s <path to schema> -o <path to generated output>"}),". Add ",(0,i.jsx)(n.code,{children:"-r"})," for React code generation, too."]}),"\n",(0,i.jsx)(n.p,{children:"The CLI will analyze your schema and the current state of your app and provide some options:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Start a new WIP schema with your schema changes and version N + 1"}),"\n",(0,i.jsx)(n.li,{children:"Publish a new schema (from an existing WIP schema, or directly from new schema changes without a WIP phase) that's ready to deploy"}),"\n",(0,i.jsx)(n.li,{children:"Just regenerate client code (useful when upgrading the CLI, this can fix bugs in generated code or add new features)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Hopefully the process is guided enough to not require too much additional explanation."}),"\n",(0,i.jsx)(n.h2,{id:"wip-schemas",children:"WIP Schemas"}),"\n",(0,i.jsx)(n.p,{children:'One feature the CLI provides is iterating on schemas in "WIP" mode. This lets you make temporary changes to a schema when developing on your local device in order to test functionality. Before you deploy your app, you will need to mark your schema as production-ready.'}),"\n",(0,i.jsx)(n.p,{children:"When using a WIP schema, a copy is made of your app data and moved into a temporary database. All your changes you make while testing will be applied on that copy of data. Sync is turned off, even if it's enabled in your development environment, because syncing changes made against a schema you may not end up using will introduce permanent invalid changes to your stored data on the server and other clients. There are ways I could make sync work with WIP schemas, but for now I haven't pursued them. Reach out if you find sync or multiplayer necessary to test your new schema locally. It's likely I will too at some point, just not yet."}),"\n",(0,i.jsx)(n.h3,{id:"verifying-your-schema-for-deployment",children:"Verifying your schema for deployment"}),"\n",(0,i.jsx)(n.p,{children:"It's important you don't deploy and use a WIP schema. If you do, any changes users make against that schema will be in a temporary copy of the database, just like local development, and so they'll be lost by the time you correct your mistake."}),"\n",(0,i.jsxs)(n.p,{children:["To help avoid this and other problems, Verdant has a ",(0,i.jsx)(n.code,{children:"verdant-preflight"})," CLI tool to validate your code before a deployment. Incorporate this into your testing suite, CI, PR approval process, or just before your final build and deploy. It will fail if any of these conditions are true:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Your client schema is WIP"}),"\n",(0,i.jsx)(n.li,{children:"Your schema doesn't match what's preloaded in your generated client (client is out of date)"}),"\n",(0,i.jsx)(n.li,{children:"You don't have a migration for your current schema version"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["To use the preflight check, run the CLI with the ",(0,i.jsx)(n.code,{children:"preflight"})," command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"verdant preflight -s <path to schema> -o <path to output> -m <path to migrations>\n"})}),"\n",(0,i.jsx)(n.h2,{id:"upgrading",children:"Upgrading"}),"\n",(0,i.jsx)(n.p,{children:"For anyone using Verdant before CLI v4 (probably nobody but me), you'll need to actually upgrade a lot of your generated client code before using the new CLI, including rewriting all historical schemas and changing some migration tool usage."}),"\n",(0,i.jsx)(n.p,{children:"It's possible this upgrade (which runs automatically when you run the CLI) will fail. In that case, get in touch on Github and we can debug."}),"\n",(0,i.jsx)(n.p,{children:"For any newcomers, please just use CLI > v4. It's much better and enables some key schema features in recent Verdant versions."})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},6039:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>r});var o=t(8225);const i={},a=o.createContext(i);function s(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);