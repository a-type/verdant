"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2651],{4852:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>f});var o=n(9231);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),l=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},u=function(e){var t=l(e.components);return o.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),d=l(n),f=r,y=d["".concat(s,".").concat(f)]||d[f]||p[f]||i;return n?o.createElement(y,a(a({ref:t},u),{},{components:n})):o.createElement(y,a({ref:t},u))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,a=new Array(i);a[0]=d;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:r,a[1]=c;for(var l=2;l<i;l++)a[l]=n[l];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8298:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>c,toc:()=>l});var o=n(7626),r=(n(9231),n(4852));const i={sidebar_position:3},a="Connecting a Client",c={unversionedId:"sync/client",id:"sync/client",title:"Connecting a Client",description:"To connect your client to the server, you must pass it sync configuration.",source:"@site/docs/sync/client.md",sourceDirName:"sync",slug:"/sync/client",permalink:"/lo-fi/docs/sync/client",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/sync/client.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Authorizing Sync",permalink:"/lo-fi/docs/sync/authorization"},next:{title:"Presence & Profiles",permalink:"/lo-fi/docs/sync/presence"}},s={},l=[{value:"Custom auth fetch",id:"custom-auth-fetch",level:2}],u={toc:l};function p(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"connecting-a-client"},"Connecting a Client"),(0,r.kt)("p",null,"To connect your client to the server, you must pass it sync configuration."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { ClientDescriptor, ServerSync } from './client/index.js';\nimport schema from './schema.js';\nimport migrations from './migrations.js';\n\nconst clientDesc = new ClientDescriptor({\n    namespace: 'todos',\n    schema,\n    migrations,\n    sync: {\n        initialPresence: {\n            emoji: '',\n        },\n        authEndpoint: 'http://localhost:3000/auth/lofi',\n    },\n});\n\nclientDesc.open().then((todos) => {\n    // now we have a todo data client, \"todos\"\n});\n")),(0,r.kt)("p",null,"You may also define type overrides to provide typing for presence data:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// extend built-in types to specify presence information\n// so it's typed throughout your app\ndeclare module '@lo-fi/web' {\n    export interface Presence {\n        emoji: string;\n    }\n\n    export interface Profile {\n        // any data you may have put in profiles on the server\n    }\n}\n")),(0,r.kt)("p",null,"To start syncing, call ",(0,r.kt)("inlineCode",{parentName:"p"},"client.sync.start")," (where ",(0,r.kt)("inlineCode",{parentName:"p"},"client")," is your instance of Client, i.e. ",(0,r.kt)("inlineCode",{parentName:"p"},"todos")," above) This will connect to your websocket server. It's up to you to add any authentication and authorization to reject unregistered or unsubscribed clients if you want to limit access to sync. lo-fi itself will sync whoever you let connect."),(0,r.kt)("p",null,"If you want to pause sync, call ",(0,r.kt)("inlineCode",{parentName:"p"},"client.sync.stop")," (where ",(0,r.kt)("inlineCode",{parentName:"p"},"client")," is your instance of Client, i.e. ",(0,r.kt)("inlineCode",{parentName:"p"},"todos")," above)."),(0,r.kt)("h2",{id:"custom-auth-fetch"},"Custom auth fetch"),(0,r.kt)("p",null,"By default the client will make a basic ",(0,r.kt)("inlineCode",{parentName:"p"},"fetch")," to your auth endpoint with ",(0,r.kt)("inlineCode",{parentName:"p"},"credentials: 'include'"),". If this endpoint is hosted on a server which your client already has a cookie session with, it should work out of the box."),(0,r.kt)("p",null,"If you use another solution for sessions, like a JWT in a header, you can pass in ",(0,r.kt)("inlineCode",{parentName:"p"},"fetchAuth")," instead of ",(0,r.kt)("inlineCode",{parentName:"p"},"authEndpoint")," to the sync configuration. This function must return a promise for the JSON response body of the authorization endpoint."))}p.isMDXComponent=!0}}]);