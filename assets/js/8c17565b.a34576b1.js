"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8376],{1809:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"integrations/tiptap","title":"TipTap Text Editor","description":"An experimental integration is available for integrating Verdant with the TipTap rich text editor. Currently this integration provides a premade Verdant field schema for a TipTap document which enforces correct (but generic) shape, and a React hook to instantiate a Verdant-synced TipTap Editor instance with one line.","source":"@site/docs/integrations/tiptap.md","sourceDirName":"integrations","slug":"/integrations/tiptap","permalink":"/docs/integrations/tiptap","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":0,"frontMatter":{"sidebar_position":0},"sidebar":"tutorialSidebar","previous":{"title":"Integrations","permalink":"/docs/category/integrations"},"next":{"title":"How it works","permalink":"/docs/category/how-it-works"}}');var o=n(7557),a=n(6039);const s={sidebar_position:0},r="TipTap Text Editor",d={},c=[{value:"Creating a TipTap document schema field",id:"creating-a-tiptap-document-schema-field",level:2},{value:"Usage with React",id:"usage-with-react",level:2},{value:"Applying Node IDs",id:"applying-node-ids",level:2},{value:"A note on &quot;collaborative text&quot;",id:"a-note-on-collaborative-text",level:2}];function l(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"tiptap-text-editor",children:"TipTap Text Editor"})}),"\n",(0,o.jsxs)(t.p,{children:["An experimental integration is available for integrating Verdant with the ",(0,o.jsx)(t.a,{href:"https://tiptap.dev",children:"TipTap rich text editor"}),". Currently this integration provides a premade Verdant field schema for a TipTap document which enforces correct (but generic) shape, and a React hook to instantiate a Verdant-synced TipTap Editor instance with one line."]}),"\n",(0,o.jsxs)(t.p,{children:["Verdant ",(0,o.jsx)(t.strong,{children:"does not currently support simultaneous text editing"}),", so don't expect a magical experience here. Use of Verdant with TipTap is mostly recommended for single-user use cases. Otherwise, you will probably want to use ",(0,o.jsx)(t.a,{href:"/docs/sync/presence",children:"presence"})," to lock text blocks while another user is editing them to avoid conflicts. Collaboration should work fairly well as long as users don't try to modify the same string at the same time."]}),"\n",(0,o.jsx)(t.h2,{id:"creating-a-tiptap-document-schema-field",children:"Creating a TipTap document schema field"}),"\n",(0,o.jsxs)(t.p,{children:["You can construct a schema for a field which represents a text document by importing ",(0,o.jsx)(t.code,{children:"createTipTapFieldSchema"})," and passing the result to your schema field."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-ts",children:"import { schema } from '@verdant-web/store';\nimport { createTipTapFieldSchema } from '@verdant-web/tiptap';\n\nexport default schema({\n\tversion: 1,\n\tcollections: {\n\t\tposts: schema.collection({\n\t\t\tname: 'post',\n\t\t\tprimaryKey: 'id',\n\t\t\tfields: {\n\t\t\t\tid: schema.fields.id(),\n\t\t\t\tbody: createTipTapFieldSchema({\n\t\t\t\t\tdefault: {\n\t\t\t\t\t\ttype: 'doc',\n\t\t\t\t\t\tcontent: [],\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t},\n\t\t}),\n\t},\n});\n"})}),"\n",(0,o.jsxs)(t.p,{children:["You are required to specify a default document value. This can be ",(0,o.jsx)(t.code,{children:"null"}),", which will make your field nullable. If it's not null, it must at least have ",(0,o.jsx)(t.code,{children:"type"})," (the type of the root document node). You can also specify ",(0,o.jsx)(t.code,{children:"content"})," (an array of child nodes), ",(0,o.jsx)(t.code,{children:"attrs"})," (a record, where values can be anything), and ",(0,o.jsx)(t.code,{children:"text"})," (if your root node is a text node -- unlikely). The above example is recommended."]}),"\n",(0,o.jsxs)(t.p,{children:["If you pass ",(0,o.jsx)(t.code,{children:"null"}),", your field will begin as ",(0,o.jsx)(t.code,{children:"null"})," unless otherwise specified. If the user adds a document to the field, you are responsible for ensuring the initial state of that document. See ",(0,o.jsx)(t.code,{children:"nullDocumentDefault"})," in ",(0,o.jsx)(t.code,{children:"useSyncedEditor"})," below."]}),"\n",(0,o.jsx)(t.h2,{id:"usage-with-react",children:"Usage with React"}),"\n",(0,o.jsx)(t.p,{children:"The library provides a single hook you can use to create a TipTap Editor that's backed with Verdant. It handles the nuances of how to apply changes between the Verdant field and the TipTap Editor for you."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",children:"import { useSyncedEditor } from '@verdant-web/tiptap/react';\nimport { EditorContent } from '@tiptap/react';\nimport StarterKit from '@tiptap/starter-kit';\n\nfunction DocumentEditor({ post }: { post: Post }) {\n\tconst editor = useSyncedEditor(post, 'body', {\n\t\teditorOptions: {\n\t\t\textensions: [StarterKit],\n\t\t},\n\t});\n\n\treturn (\n\t\t<EditorContent\n\t\t\teditor={editor}\n\t\t\tstyle={{ width: 500, height: 300, border: '1px solid black' }}\n\t\t/>\n\t);\n}\n"})}),"\n",(0,o.jsx)(t.p,{children:"The parameters of the hook are:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"The parent object or document which has the TipTap field. You must pass the parent, not the field itself. This is to support cases where we must reassign the parent field entirely, like initializing a fresh document."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"The name of the field which has the TipTap document. This will be typechecked against the first parameter."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Additional options, including:"}),"\n",(0,o.jsxs)(t.p,{children:["a. ",(0,o.jsx)(t.code,{children:"nullDocumentDefault"}),": A default document snapshot value to use if the document field is ",(0,o.jsx)(t.code,{children:"null"}),". You should provide this if your field is nullable and you haven't included any logic to prevent the rendering of the current component if the field is missing. It must be a full document snapshot and will be passed to the editor until the Verdant field is initialized on first change."]}),"\n",(0,o.jsxs)(t.p,{children:["b. ",(0,o.jsx)(t.code,{children:"editorOptions"}),": Additional options to configure the editor, see ",(0,o.jsx)(t.code,{children:"useEditor"})," from TipTap's React library"]}),"\n",(0,o.jsxs)(t.p,{children:["c. ",(0,o.jsx)(t.code,{children:"editorDependencies"}),": Values to include in the dependency array of ",(0,o.jsx)(t.code,{children:"useEditor"}),". Be careful, these will cause the editor to be recreated when changing."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["Other than that, everything is taken care of. Pass the ",(0,o.jsx)(t.code,{children:"editor"})," returned to the ",(0,o.jsx)(t.code,{children:"editor"})," prop of ",(0,o.jsx)(t.code,{children:"EditorContent"})," from ",(0,o.jsx)(t.code,{children:"@tiptap/react"}),", and you can now edit the document and watch as changes are persisted locally and synced to peers."]}),"\n",(0,o.jsx)(t.h2,{id:"applying-node-ids",children:"Applying Node IDs"}),"\n",(0,o.jsx)(t.p,{children:"Applying an ID to all document nodes can be pretty helpful, especially if you're tracking user presence per-block to show in the UI."}),"\n",(0,o.jsxs)(t.p,{children:["First, I recommend you consider supporting TipTap by licensing their ",(0,o.jsx)(t.a,{href:"https://tiptap.dev/docs/editor/extensions/functionality/uniqueid",children:"official UniqueID extension"})," to accomplish this. But, that said..."]}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"@verdant-web/tiptap"})," library also exports a ",(0,o.jsx)(t.code,{children:"NodeIdExtension"})," which will apply a unique ID to the ",(0,o.jsx)(t.code,{children:"attrs.id"})," of every non-text node."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-ts",children:"import { NodeIdExtension } from '@verdant-web/tiptap';\n\nuseSyncedEditor(post, 'body', {\n\teditorOptions: { extensions: [NodeIdExtension()] },\n});\n"})}),"\n",(0,o.jsx)(t.p,{children:"It doesn't support much customization, but you can change which node types it applies to by passing an options argument. This is the minimal functionality to enable features like presence, so it felt important to include."}),"\n",(0,o.jsxs)(t.p,{children:["To actually support inline presence decorations, though, you will have to use a custom node view to apply the presence UI on each block. I leave that up to you and the ",(0,o.jsx)(t.a,{href:"https://tiptap.dev/docs/editor/extensions/custom-extensions/node-views",children:"TipTap docs"}),"."]}),"\n",(0,o.jsx)(t.h2,{id:"a-note-on-collaborative-text",children:'A note on "collaborative text"'}),"\n",(0,o.jsxs)(t.p,{children:["As stated in the introduction, Verdant doesn't currently support realtime collaborative ",(0,o.jsx)(t.em,{children:"text editing"}),", like you might expect from, say, Google Docs. This doesn't mean users can't collaborate on a document at all. What it means, specifically, is that two users editing the same exact paragraph (or any text node) will have a bad time, with each person's changes disrupting the other, and cursor position may jump around unexpectedly, etc."]}),"\n",(0,o.jsx)(t.p,{children:"I don't have any particular plans to support collaborative string editing. So keep that in mind. The existence of this integration doesn't imply any further development or support on that front."}),"\n",(0,o.jsxs)(t.p,{children:["That said, there are simple UX tricks you can use to avoid simultaneous edits of the same text node. I think locking a node while another user is editing it using ",(0,o.jsx)(t.a,{href:"/docs/sync/presence",children:"presence"})," isn't terrible, personally. I like to imagine what would happen if you were actually collaborating with someone on a document in real life -- probably only one person would be actively writing at any point in time. I think it's more compelling to imagine digital analogues to that human experience than to enable very complicated simultaneous edit behavior which has no physical basis. But that's my own biases showing."]})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},6039:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>r});var i=n(8225);const o={},a=i.createContext(o);function s(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(a.Provider,{value:t},e.children)}}}]);